{% extends "layout.nunjucks" %}

{% set page_title = "events" %}

{% block site_title %}Register for the Emma's Hope 2019 Golf For Hope Charity Golf Tournament | {% endblock %}

{% block share_meta %}
<meta property="og:url" content="https://www.emmashopeinc.org/events/golf-for-hope/2019/register/" />
<meta property="og:type" content="article" />
<meta property="og:title" content="Register for Emma's Hope Golf for Hope Charity Golf Tournament" />
<meta property="og:description" content="Register as a team, single player, or dinner guest today for our Golf for Hope Charity Golf Tournament. We are playing at Kanon Valley Country Club in Oneida, NY on Saturday, July 13, 2019." />
<meta property="og:image" content="https://www.emmashopeinc.org/img/golf-for-hope/2019/golf-for-hope-2019-std_red.jpg" />
{% endblock share_meta %}

{% block fb_sdk %}
  <div id="fb-root"></div>
  <script async defer crossorigin="anonymous" src="https://connect.facebook.net/en_US/sdk.js#xfbml=1&version=v3.2&appId=350999785674997&autoLogAppEvents=1"></script>
{% endblock %}

{% block page_class %}no-promo events{% endblock %}

{% block promomtions %}{% endblock %}
{% block cta %}{% endblock %}

{% block site_content %}
  
  <section class="content-block text-center no-margin-bottom">
    <h1 class="site-title">Tournament Registration</h1>
    <p>Saturday, July 13, 2019 &mdash; Kanon Valley Country Club <a class="nolink" href="https://maps.google.com/?saddr=Current+Location&daddr=43.140974664881824,-75.70847315000003&driving" target="_blank">(get directions)</a></p>
    <!-- <p>Rather register by mail & check?<br><a href="/events/golf-for-hope/2019/2019-registration-form-nofill.pdf" target="_blank">Download the Registration Form</a></p> -->
  </section>
  
  <!-- <div class="callout text-center margin-bottom no-margin-top">
    <p class="sans spaced upper"><strong>Registration ends June 30th, 2018</strong></p>
  </div> -->
  
  <section id="js-registration-block" class="content-block">
    <div class="text-center">
      <h3 class="sans text-center">Choose to register as...</h3>
      
      <div class="golfer-choices">
        <input data-price="320" id="golfer_foursome" value="foursome" type="radio" name="golfer_type" class="golfer-radio">
        <label for="golfer_foursome" class="golfer-choice">
          A team of four <span class="price">$320 + $7.51 PayPal fee</span>
          <p>Includes 18 holes of golf, cart, food, entry to the longest drive contest.</p>
        </label>
        
        <input data-price="80" id="golfer_single" value="single" type="radio" name="golfer_type" class="golfer-radio">
        <label for="golfer_single" class="golfer-choice">
          A single golfer <span class="price">$80 + $2.11 PayPal fee</span>
          <p>Includes 18 holes of golf, cart, food, entry to the longest drive contest.</p>
        </label>
        
        <!--
        <input data-price="50" id="golfer_dinner" value="dinner" type="radio" name="golfer_type" class="golfer-radio">
        <label for="golfer_dinner" class="golfer-choice">
          A Dinner guest only <span class="price">$50 + $1.43 PayPal fee</span>
          <p>Ability to participate in 50/50 raffle, silent and basket auctions.</p>
        </label>
        -->
      </div>
      
      <p class="margin-bottom--big sans"><strong>Total cost today: <span class="js-total">$0</span></strong></p>
    </div>
    
    <form id="register-foursome" action="" method="GET" class="register-form is-hidden">     
      <div id="golfer-foursome">
        <div class="form-field">
          <div class="form-row">
            <label for="team_name">Team Name: <span>(required)</span></label>
            <input id="team_name" type="text" class="js-fields inputs" required>
          </div>
        </div>
        
        <div class="form-field">
          <h2>Golfer 1 <span>(Team Captain)</span></h2>
          <div class="form-row">
            <label for="golfer_1_name">Full Name: <span>(required)</span></label>
            <input id="golfer_1_name" type="text" name="golf1n" class="js-fields inputs" required>
          </div>
          <div class="form-row">
            <label for="golfer_1_email">Email: <span>(required)</span></label>
            <input id="golfer_1_email" type="email" name="golf1e" class="js-fields inputs" required>
          </div>
        </div>
        
        <div class="form-field">
          <h2>Golfer 2</h2>
          <div class="form-row">
            <label for="golfer_2_name">Full Name: <span>(required)</span></label>
            <input id="golfer_2_name" type="text" name="golf2n" class="js-fields inputs" required>
          </div>
          <div class="form-row">
            <label for="golfer_2_email">Email:</label>
            <input id="golfer_2_email" type="email" name="golf2e" class="js-fields inputs">
          </div>
        </div>
        
        <div class="form-field">
          <h2>Golfer 3</h2>
          <div class="form-row">
            <label for="golfer_3_name">Full Name: <span>(required)</span></label>
            <input id="golfer_3_name" type="text" name="golf3n" class="js-fields inputs" required>
          </div>
          <div class="form-row">
            <label for="golfer_3_email">Email:</label>
            <input id="golfer_3_email" type="email" name="golf3e" class="js-fields inputs">
          </div>
        </div>
        
        <div class="form-field">
          <h2>Golfer 4</h2>
          <div class="form-row">
            <label for="golfer_4_name">Full Name: <span>(required)</span></label>
            <input id="golfer_4_name" type="text" name="golf4n" class="js-fields inputs" required>
          </div>
          <div class="form-row">
            <label for="golfer_4_email">Email:</label>
            <input id="golfer_4_email" type="email" name="golf4e" class="js-fields inputs">
          </div>
        </div>
      </div>
      <p class="callout"><small>NOTE: The PayPal button assumes you have a PayPal account. If you wish to use a credit card instead, click one of the credit card buttons under the PayPal button.</small></p>
      <div id="foursome-paypal-button" class="paypal-buttons margin-top text-center"></div>
    </form>
    
    <form id="register-single" action="./" method="GET" class="register-form is-hidden">
      <p class="text-center">We're happy to add you to a team of four for the tournament.</p>
      <div class="form-field">
        <h2>Your Information</h2>
        <div class="form-row">
          <label for="single_name">Full Name: <span>(required)</span></label>
          <input id="single_name" type="text" class="js-fields inputs" required>
        </div>
        <div class="form-row">
          <label for="single_email">Email: <span>(required)</span></label>
          <input id="single_email" type="email" class="js-fields inputs" required>
        </div>
      </div>
      <p class="callout"><small>NOTE: The PayPal button assumes you have a PayPal account. If you wish to use a credit card instead, click one of the credit card buttons under the PayPal button.</small></p>
      <div id="single-paypal-button" class="paypal-buttons margin-top text-center"></div>
    </form>
    
    <!--
    <form id="register-dinner" action="./" method="GET" class="register-form is-hidden">
      <div class="form-field">
        <h2>Your Information</h2>
        <div class="form-row">
          <label for="dinner_name">Full Name: <span>(required)</span></label>
          <input id="dinner_name" type="text" class="js-fields inputs" required>
        </div>
        <div class="form-row">
          <label for="dinner_email">Email: <span>(required)</span></label>
          <input id="dinner_email" type="email" class="js-fields inputs" required>
        </div>
      </div>
      <div id="dinner-paypal-button" class="paypal-buttons margin-top text-center"></div>
    </form>
    -->
    
    <div class="text-center margin-top">
      <div class="fb-share-button" data-href="https://emmashopeinc.org/events/golf-for-hope/2019/register/" data-layout="button_count" data-size="large"><a target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Femmashopeinc.org%2Fevents%2Fgolf-for-hope%2F2019%2Fregister%2F&amp;src=sdkpreparse" class="fb-xfbml-parse-ignore">Share</a></div>
    </div>
    
  </section>
  
  <section id="js-thankyou" class="is-hidden content-block text-center">
    <div></div>
    <button class="button js-reset-sections">Register Again</button>
  </section>
  
  <section class="info-block bg--gray margin-top">
    <div class="info-block-left text-center">
      <h3>Player's Pack Add-on</h3>
      <p>(Purchase for $40/team at the Event)</p>
      <ul class="text-left">
        <li>Entry to Closest to the Pin contest</li>
        <li>Entry to Hole in One contest</li>
        <li>Two Mulligans</li>
      </ul>
    </div>
    <div class="info-block-right text-center border-left border-top--mobile">
      <h3>Individual Add-ons</h3>
      <p>(Purchase individually at the Event)</p>
      <ul class="text-left">
        <li>$25 &mdash; Entry to Closest to the Pin contest</li>
        <li>$25 &mdash; Entry to Hole in One contest</li>
        <li>$20 &mdash; Team entry for Skins</li>
        <li>$10 &mdash; Two mulligans</li>
      </ul>
    </div>
  </section>
  
  <section class="padding-vertical border-bottom text-center">
    <p>For Registration Information or Questions, contact Emma's Hope at <a href="tel:+13152175567">315-217-5567</a> or <a href="mailto:events@emmashopeinc.org">events@emmashopeinc.org</a></p>
  </section>
{% endblock %}

{% block footer_scripts %}
  {# ENV:
  Production: AbD54RN7hUgyCHiv6hHdt7JDjnFIb6JKBOuczgg0xkXpYxJ9M9inRd__o5hVEQraG8tvPHcmpOehi_Bj
  Sandbox: sb #}
  <script src="https://www.paypal.com/sdk/js?client-id=AbD54RN7hUgyCHiv6hHdt7JDjnFIb6JKBOuczgg0xkXpYxJ9M9inRd__o5hVEQraG8tvPHcmpOehi_Bj&currency=USD&intent=capture&commit=false&vault=false&disable-funding=sepa,credit&disable-card=jcb,elo,hiper"></script>
  <script>function scrollIt(destination,duration=200,easing='linear',callback){const easings={linear(t){return t},easeInQuad(t){return t*t},easeOutQuad(t){return t*(2-t)},easeInOutQuad(t){return t<0.5?2*t*t:-1+(4-2*t)*t},easeInCubic(t){return t*t*t},easeOutCubic(t){return(--t)*t*t+1},easeInOutCubic(t){return t<0.5?4*t*t*t:(t-1)*(2*t-2)*(2*t-2)+1},easeInQuart(t){return t*t*t*t},easeOutQuart(t){return 1-(--t)*t*t*t},easeInOutQuart(t){return t<0.5?8*t*t*t*t:1-8*(--t)*t*t*t},easeInQuint(t){return t*t*t*t*t},easeOutQuint(t){return 1+(--t)*t*t*t*t},easeInOutQuint(t){return t<0.5?16*t*t*t*t*t:1+16*(--t)*t*t*t*t}};const start=window.pageYOffset;const startTime='now' in window.performance?performance.now():new Date().getTime();const documentHeight=Math.max(document.body.scrollHeight,document.body.offsetHeight,document.documentElement.clientHeight,document.documentElement.scrollHeight,document.documentElement.offsetHeight);const windowHeight=window.innerHeight||document.documentElement.clientHeight||document.getElementsByTagName('body')[0].clientHeight;const destinationOffset=typeof destination==='number'?destination:destination.offsetTop;const destinationOffsetToScroll=Math.round(documentHeight-destinationOffset<windowHeight?documentHeight-windowHeight:destinationOffset);if('requestAnimationFrame' in window===!1){window.scroll(0,destinationOffsetToScroll);if(callback){callback()}
return}
function scroll(){const now='now' in window.performance?performance.now():new Date().getTime();const time=Math.min(1,((now-startTime)/duration));const timeFunction=easings[easing](time);window.scroll(0,Math.ceil((timeFunction*(destinationOffsetToScroll-start))+start));if(window.pageYOffset===destinationOffsetToScroll){if(callback){callback()}
return}
requestAnimationFrame(scroll)}
scroll()}</script>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const STYLE = { layout: 'vertical', shape: 'pill', color: 'gold' };
      const IDS = {
        sandbox:'ARJYx_AyuvqPOWkfLNZ19QqEWcNc4a8o9flkOP1uTh2lpc1ZyTDuh4UIRLKCiIso9F3JRUk9cZhXRu4-',
        production: 'AbD54RN7hUgyCHiv6hHdt7JDjnFIb6JKBOuczgg0xkXpYxJ9M9inRd__o5hVEQraG8tvPHcmpOehi_Bj'
      };
      
      const APIData = {
        'headers': new Headers({
          'Accept': 'application/json'
        }),
        'urls': {
          'upload': 'https://script.google.com/macros/s/AKfycby8Dpcioipqmz0gf-nbO5t6sKQSdU_7FVg4Tx-blB24edyRqg8/exec'
        }
      };
      
      const callAPI = async (APIurl, data) => {
        // Options for the fetch call
        let fetchOptions = {
          headers: APIData.headers,
          method: 'GET'
        };

        // Make the request to the server and return
        // the response once the Promise is resolved
        return (await fetch(APIurl, fetchOptions)).json();
      }
      
      function isValid(formName) {
        return document.getElementById('register-' + formName).checkValidity();
      }
      
      function resetForms() {
        ['foursome', 'single'].forEach( (form) => {
          document.getElementById(`register-${form}`).reset();
        });
      }
      
      function listener(arr, add, evt, fn) {
        arr.forEach(function(item) {
          if (add) {
            item.addEventListener(evt, fn, false);
          } else {
            item.removeEventListener(evt, fn, false);
          }
        });
      }
      
      function onBlurFields(formName, handler) {
        let form = document.getElementById('register-' + formName);
        let allFields = [].slice.call(document.querySelectorAll('.js-inputs'));
        let formFields = [].slice.call(form.querySelectorAll('.js-fields'));
        
        listener(allFields, false, 'blur', handler);
        listener(formFields, true, 'blur', handler);
      }
      
      function toggleValidationMessage(formName) {
        document.getElementById('register-' + formName).reportValidity();
      }
      
      function toggleButtons(formName, actions) {
        return isValid(formName) ? actions.enable() : actions.disable();
      }
      
      function toggleVisibleSections() {
        [registerSection, thankYouSection].forEach( (sections) => {
          sections.classList.toggle('is-hidden');
        });
      }
      
      function resetSections() {
        resetForms();
        toggleVisibleSections();
        thankYouContent.innerHTML = '';
      }
      
      function thankYouMessage(details) {
        return `<h2 class="text-center">Thank you, ${details.payer.name.given_name}!</h2>
    <h3 class="text-center">You are now registered for <br>Golf for Hope 2019!</h3>
    <p>An email will be sent to ${details.payer.email_address} for your registration, as well as a reminder email with more instructions the week before the event.</p>
    <p>We'll see you on Saturday, July 13th, 2019!</p>`;
      }
      
      paypal.Buttons({      
        onInit: function(data, actions) {
          toggleButtons('foursome', actions);
          
          onBlurFields('foursome', function() {
            toggleButtons('foursome', actions);
          });
        },
        
        onClick: function() {
          toggleValidationMessage('foursome');
        },

        createOrder: function(data, actions) {
          return actions.order.create({
            purchase_units: [{
                amount: { value: 327.51, currency_code: 'USD' },
                description: 'Golf For Hope 2019 Registration - Foursome'
            }]
          });
        },

        onApprove: function(data, actions) {
          return actions.order.capture().then(function(details) {
            
            let formData = {
              "team_name": document.getElementById('team_name').value,
              "registration_date": new Date(Date.now()).toLocaleString().split(',')[0],
              "registration_type": 'Foursome',
              "date_paid": new Date(Date.now()).toLocaleString().split(',')[0],
              "single_name": '',
              "single_email": '',
              "golfer_1_name": document.getElementById('golfer_1_name').value,
              "golfer_1_email": document.getElementById('golfer_1_email').value,
              "golfer_2_name": document.getElementById('golfer_2_name').value,
              "golfer_2_email": document.getElementById('golfer_2_email').value,
              "golfer_3_name": document.getElementById('golfer_3_name').value,
              "golfer_3_email": document.getElementById('golfer_3_email').value,
              "golfer_4_name": document.getElementById('golfer_4_name').value,
              "golfer_4_email": document.getElementById('golfer_4_email').value
            };
            newData = JSON.stringify(formData);
            newData = newData.replace(/{"/g, "?");
            newData = newData.replace(/":"/g, "=");
            newData = newData.replace(/","/g, "&");
            newData = newData.replace(/"}/g, "");
            
            callAPI(APIData.urls.upload + newData, formData)
              .then((uploadResponse) => {
                if (uploadResponse.result === 'success') {
                  toggleVisibleSections();
                  thankYouContent.innerHTML = thankYouMessage(details);
                  //window.location.replace('https://www.emmashopeinc.org/events/golf-for-hope/2019/thank-you/');
                }
            });
          });
        },
        
        onCancel: function(data) {
          window.location.replace('https://www.emmashopeinc.org/events/golf-for-hope/2019/cancel/');
        },
        
        onError: function(err) {
          console.error(err);
        }

      }).render('#foursome-paypal-button');
      
      // Single Form
      paypal.Buttons({
        onInit: function(data, actions) {
          toggleButtons('single', actions);
          
          onBlurFields('single', function() {
            toggleButtons('single', actions);
          });
        },
        
        onClick: function() {
          toggleValidationMessage('single');
        },

        createOrder: function(data, actions) {
          return actions.order.create({
            purchase_units: [{
                amount: { value: 82.11, currency_code: 'USD' },
                description: 'Golf For Hope 2019 Registration - Single'
            }]
          });
        },

        onApprove: function(data, actions) {
          return actions.order.capture().then(function(details) {
            console.log(details);
            let formData = {
              "team_name": '',
              "registration_date": new Date(Date.now()).toLocaleString().split(',')[0],
              "registration_type": 'Single',
              "date_paid": new Date(Date.now()).toLocaleString().split(',')[0],
              "single_name": document.getElementById('single_name').value,
              "single_email": document.getElementById('single_email').value,
              "golfer_1_name": '', "golfer_1_email": '', "golfer_2_name": '', "golfer_2_email": '', "golfer_3_name": '', "golfer_3_email": '', "golfer_4_name": '', "golfer_4_email": ''
            };
            newData = JSON.stringify(formData);
            newData = newData.replace(/{"/g, "?");
            newData = newData.replace(/":"/g, "=");
            newData = newData.replace(/","/g, "&");
            newData = newData.replace(/"}/g, "");
            
            callAPI(APIData.urls.upload + newData, formData)
              .then((uploadResponse) => {
                if (uploadResponse.result === 'success') {
                  toggleVisibleSections();
                  thankYouContent.innerHTML = thankYouMessage(details);
                  //window.location.replace('https://emmashopeinc.org/events/golf-for-hope/2019/thank-you/');
                }
            });
          });
        },
        
        onCancel: function(data) {
          window.location.replace('https://www.emmashopeinc.org/events/golf-for-hope/2019/cancel/');
        },
        
        onError: function(err) {
          console.error(err);
        }

      }).render('#single-paypal-button');
        
      // Dinner Form
      /*
      paypal.Buttons({
        validate: function(actions) {
          toggleButtons('dinner', actions);
          
          onBlurFields('dinner', function() {
            toggleButtons('dinner', actions);
          });
        },
        
        onClick: function() {
          toggleValidationMessage('dinner');
        },

        payment: function(data, actions) {
          return actions.order.create({
            purchase_units: [{
                amount: { value: 51.43, currency_code: 'USD' },
                description: 'Golf For Hope 2019 Registration - Dinner'
            }],
            application_context: {
              payment_method: {
                payer_selected: PAYPAL,
                payee_preferred: IMMEDIATE_PAYMENT_REQUIRED
              },
              return_url: 'https://emmashopeinc.org/events/golf-for-hope/2019/thank-you/',
              cancel_url: 'https://emmashopeinc.org/events/golf-for-hope/2019/cancel/'
            }
          });
        },

        onApprove: function(data, actions) {
          return actions.order.capture().then(function(details) {
            
            let formData = {
              "team_name": '',
              "registration_date": new Date(Date.now()).toLocaleString().split(',')[0],
              "registration_type": 'Dinner',
              "date_paid": new Date(Date.now()).toLocaleString().split(',')[0],
              "single_name": document.getElementById('dinner_name').value,
              "single_email": document.getElementById('dinner_email').value,
              "golfer_1_name": '', "golfer_1_email": '', "golfer_2_name": '', "golfer_2_email": '', "golfer_3_name": '', "golfer_3_email": '', "golfer_4_name": '', "golfer_4_email": ''
            };
            newData = JSON.stringify(formData);
            newData = newData.replace(/{"/g, "?");
            newData = newData.replace(/":"/g, "=");
            newData = newData.replace(/","/g, "&");
            newData = newData.replace(/"}/g, "");
            
            callAPI(APIData.urls.upload + newData, formData)
              .then((uploadResponse) => {
                if (uploadResponse.result === 'success') {
                  console.log(actions);
                  //return actions.redirect();
                }
            });
          });
        },
        
        onError: function(err) {
          console.log(err);
        }

      }).render('#dinner-paypal-button');
      */
      
      const registerForms = [].slice.call(document.querySelectorAll('.register-form'));
      const priceTotal = document.querySelector('.js-total');
      const golferButtons = [].slice.call(document.querySelectorAll('.golfer-radio'));
      const PP_PERCENT = 0.022;
      const PP_FEE = .30;
      
      let registerSection = document.querySelector('#js-registration-block');
      let thankYouSection = document.querySelector('#js-thankyou');
      let thankYouContent = thankYouSection.querySelector('div');
      let buttonsLoaded = false;
      let resetButton = document.querySelector('.js-reset-sections');
      
      resetButton.addEventListener('click', resetSections, false);
      
      const showHideForms = function(toShow, toHide) {
        toHide.forEach(function(ele) {
          if (!ele.classList.contains('is-hidden')) {
            ele.classList.add('is-hidden');
          }
        });
        toShow.classList.remove('is-hidden');
      }
      
      const updateInfo = function(ele) {
        let amount = (parseFloat(ele.dataset.price) + PP_FEE) / (1 - PP_PERCENT);
        priceTotal.innerHTML = '$' + amount.toFixed(2);
      }
      
      golferButtons.forEach(function(button) {
        button.addEventListener('change', function() {
          let val = this.value;
          // if (!buttonsLoaded) {
          //   let fnName = 'renderPayPal' + this.value.charAt(0).toUpperCase() + this.value.slice(1);
          //   console.log(fnName);
          //   window[fnName]();
          //   buttonsLoaded = true;
          // }
          
          if (document.documentElement.clientHeight <= 700 && val === 'foursome') {
            scrollIt(document.querySelector('.js-total'), 300, 'easeOutQuad');
          }
          
          showHideForms(document.getElementById('register-'+ this.value), registerForms);
          
          updateInfo(this);
        });
      });
    });
  </script>
{% endblock %}